<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>French Tour Guide AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  color:white;
}
.app{
  display:grid;
  grid-template-columns:260px 1fr;
  min-height:100vh;
}
aside{
  background:rgba(0,0,0,.35);
  padding:20px;
}
aside h2{text-align:center}
aside button{
  width:100%;padding:12px;margin-bottom:10px;
  border:none;border-radius:8px;
  background:#ffcc00;font-weight:bold;cursor:pointer;
}
main{padding:25px}
.section{display:none}
.section.active{display:block}
.card{
  background:rgba(255,255,255,.12);
  padding:20px;border-radius:15px;margin-bottom:20px;
}
input,select,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:8px;border:none;
}
.option{
  background:rgba(255,255,255,.2);
  padding:10px;border-radius:8px;
  margin-top:10px;cursor:pointer;
}
.correct{background:#2ecc71}
.wrong{background:#e74c3c}
</style>
</head>

<body>
<div class="app">

<aside>
<h2>üá´üá∑ Tour Guide AI</h2>
<button onclick="show('vocab')">Kosakata</button>
<button onclick="show('speak')">Pengucapan</button>
<button onclick="show('quiz')">Quiz</button>
<button onclick="show('ai')">AI Trainer</button>
</aside>

<main>

<!-- KOSAKATA -->
<div id="vocab" class="section active">
<div class="card">
<h3>Tambah Kosakata</h3>
<input id="fr" placeholder="Prancis">
<input id="id" placeholder="Indonesia">
<button onclick="addVocab()">Simpan</button>
</div>

<div class="card">
<h3>Upload Dokumen (CSV / TXT)</h3>
<input type="file" id="fileInput" accept=".csv,.txt">
<button onclick="importFile()">Import</button>
</div>

<div class="card">
<h3>Daftar Kosakata</h3>
<ul id="list"></ul>
</div>
</div>

<!-- PENGUCAPAN -->
<div id="speak" class="section">
<div class="card">
<h3>Latihan Pengucapan</h3>
<p id="currentWord">Klik AI</p>
<button onclick="aiSpeak()">AI Bacakan</button>
<button onclick="userSpeak()">Saya Ucapkan</button>
<p id="feedback"></p>
</div>
</div>

<!-- QUIZ -->
<div id="quiz" class="section">
<div class="card">
<h3>Quiz</h3>
<div id="quizBox"></div>
<button onclick="generateQuiz()">Mulai Quiz</button>
<p id="scoreText"></p>
</div>
</div>

<!-- AI -->
<div id="ai" class="section">
<div class="card">
<h3>AI Trainer (Online)</h3>
<button onclick="aiSentence()">AI Kalimat Wisata</button>
<button onclick="aiQuiz()">AI Quiz Baru</button>
<pre id="aiResult"></pre>
</div>
</div>

</main>
</div>

<script>
let vocab=JSON.parse(localStorage.getItem("vocab"))||[];
let current=null,score=0;

function show(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function addVocab(){
  vocab.push({fr:fr.value,id:id.value});
  localStorage.setItem("vocab",JSON.stringify(vocab));
  render();
}

function render(){
  list.innerHTML="";
  vocab.forEach(v=>{
    let li=document.createElement("li");
    li.textContent=`${v.fr} = ${v.id}`;
    list.appendChild(li);
  });
}
render();

/* UPLOAD FILE */
function importFile(){
  let file=fileInput.files[0];
  let r=new FileReader();
  r.onload=e=>{
    e.target.result.split("\n").forEach(l=>{
      let p=l.split(",");
      if(p.length>=2)vocab.push({fr:p[0],id:p[1]});
    });
    localStorage.setItem("vocab",JSON.stringify(vocab));
    render();
  };
  r.readAsText(file);
}

/* SPEECH */
function aiSpeak(){
  current=vocab[Math.floor(Math.random()*vocab.length)];
  currentWord.innerText=current.fr;
  let u=new SpeechSynthesisUtterance(current.fr);
  u.lang="fr-FR";
  speechSynthesis.speak(u);
}

function userSpeak(){
  let R=window.SpeechRecognition||webkitSpeechRecognition;
  let rec=new R();
  rec.lang="fr-FR";
  rec.onresult=e=>{
    let t=e.results[0][0].transcript;
    feedback.innerText = t.toLowerCase()==current.fr.toLowerCase()
      ?"‚úÖ Benar":"‚ùå Coba lagi";
  };
  rec.start();
}

/* QUIZ */
function generateQuiz(){
  let q=vocab[Math.floor(Math.random()*vocab.length)];
  current=q;
  let opts=[q.id];
  while(opts.length<4){
    let r=vocab[Math.floor(Math.random()*vocab.length)].id;
    if(!opts.includes(r))opts.push(r);
  }
  opts.sort(()=>Math.random()-0.5);
  quizBox.innerHTML=`Arti dari <b>${q.fr}</b>?`;
  opts.forEach(o=>{
    let d=document.createElement("div");
    d.className="option";
    d.textContent=o;
    d.onclick=()=>check(d,o);
    quizBox.appendChild(d);
  });
}
function check(el,a){
  if(a==current.id){el.classList.add("correct");score++}
  else el.classList.add("wrong");
  scoreText.innerText="Skor: "+score;
}

/* AI ONLINE */
async function aiSentence(){
  aiResult.textContent="AI berpikir...";
  let r=await fetch("http://localhost:3000/ai/sentence",{method:"POST"});
  let j=await r.json();
  aiResult.textContent=j.text;
}
async function aiQuiz(){
  aiResult.textContent="AI membuat quiz...";
  let r=await fetch("http://localhost:3000/ai/quiz",{method:"POST"});
  let j=await r.json();
  aiResult.textContent=j.text;
}
</script>
</body>
</html>
